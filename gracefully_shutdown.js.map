{"version":3,"file":"gracefully_shutdown.js","sources":["build/compiled/logging.js","build/compiled/gracefully_shutdown.js"],"sourcesContent":["let _infoLogger = console.info;\nlet _errorLogger = console.error;\nexport function initLogger(infoLogger, errorLogger) {\n    if (infoLogger !== undefined && infoLogger !== null)\n        _infoLogger = infoLogger;\n    if (errorLogger !== undefined && errorLogger !== null)\n        _errorLogger = errorLogger;\n}\nexport function info(message) {\n    _infoLogger(message);\n}\nexport function error(message) {\n    _errorLogger(message);\n}\n//# sourceMappingURL=logging.js.map","import { error, info } from './logging';\nconst SIGTERM = \"SIGTERM\";\nconst SIGINT = \"SIGINT\";\nfunction checkError(err) {\n    if (typeof err === \"string\") {\n        error(\"Error in close operation. S:\" + err);\n    }\n    else if (err instanceof Error) {\n        error(\"Error in close operation. E:\" + err.message);\n    }\n    else {\n        error(\"Error in close operation. K:\" + err);\n    }\n}\n/**\n * This function support the common way for gracefully shutdown.\n * @param name operation name for logging.\n * @param onClose the handler to run on closing.\n */\nexport function GracefullyShutdown(name, onClose) {\n    let isClosed = false;\n    function closeConnection() {\n        if (isClosed) {\n            return;\n        }\n        isClosed = true;\n        process.off(SIGTERM, closeConnection);\n        process.off(SIGINT, closeConnection);\n        try {\n            const result = onClose();\n            if (result === undefined || result === null) {\n                info(`${name} closed (S).`);\n            }\n            else if (result instanceof Promise) {\n                result\n                    .then(() => {\n                    info(`${name} closed (A).`);\n                })\n                    .catch(checkError);\n            }\n        }\n        catch (err) {\n            checkError(err);\n        }\n    }\n    process.on(SIGTERM, closeConnection);\n    process.on(SIGINT, closeConnection);\n}\n//# sourceMappingURL=gracefully_shutdown.js.map"],"names":[],"mappings":";;;;AAAA,IAAI,WAAW,GAAG,OAAO,CAAC,IAAI,CAAC;AAC/B,IAAI,YAAY,GAAG,OAAO,CAAC,KAAK,CAAC;AAC1B,SAAS,UAAU,CAAC,UAAU,EAAE,WAAW,EAAE;AACpD,IAAI,IAAI,UAAU,KAAK,SAAS,IAAI,UAAU,KAAK,IAAI;AACvD,QAAQ,WAAW,GAAG,UAAU,CAAC;AACjC,IAAI,IAAI,WAAW,KAAK,SAAS,IAAI,WAAW,KAAK,IAAI;AACzD,QAAQ,YAAY,GAAG,WAAW,CAAC;AACnC,CAAC;AACM,SAAS,IAAI,CAAC,OAAO,EAAE;AAC9B,IAAI,WAAW,CAAC,OAAO,CAAC,CAAC;AACzB,CAAC;AACM,SAAS,KAAK,CAAC,OAAO,EAAE;AAC/B,IAAI,YAAY,CAAC,OAAO,CAAC,CAAC;AAC1B;;ACZA,MAAM,OAAO,GAAG,SAAS,CAAC;AAC1B,MAAM,MAAM,GAAG,QAAQ,CAAC;AACxB,SAAS,UAAU,CAAC,GAAG,EAAE;AACzB,IAAI,IAAI,OAAO,GAAG,KAAK,QAAQ,EAAE;AACjC,QAAQ,KAAK,CAAC,8BAA8B,GAAG,GAAG,CAAC,CAAC;AACpD,KAAK;AACL,SAAS,IAAI,GAAG,YAAY,KAAK,EAAE;AACnC,QAAQ,KAAK,CAAC,8BAA8B,GAAG,GAAG,CAAC,OAAO,CAAC,CAAC;AAC5D,KAAK;AACL,SAAS;AACT,QAAQ,KAAK,CAAC,8BAA8B,GAAG,GAAG,CAAC,CAAC;AACpD,KAAK;AACL,CAAC;AACD;AACA;AACA;AACA;AACA;AACO,SAAS,kBAAkB,CAAC,IAAI,EAAE,OAAO,EAAE;AAClD,IAAI,IAAI,QAAQ,GAAG,KAAK,CAAC;AACzB,IAAI,SAAS,eAAe,GAAG;AAC/B,QAAQ,IAAI,QAAQ,EAAE;AACtB,YAAY,OAAO;AACnB,SAAS;AACT,QAAQ,QAAQ,GAAG,IAAI,CAAC;AACxB,QAAQ,OAAO,CAAC,GAAG,CAAC,OAAO,EAAE,eAAe,CAAC,CAAC;AAC9C,QAAQ,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,eAAe,CAAC,CAAC;AAC7C,QAAQ,IAAI;AACZ,YAAY,MAAM,MAAM,GAAG,OAAO,EAAE,CAAC;AACrC,YAAY,IAAI,MAAM,KAAK,SAAS,IAAI,MAAM,KAAK,IAAI,EAAE;AACzD,gBAAgB,IAAI,CAAC,CAAC,EAAE,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC;AAC5C,aAAa;AACb,iBAAiB,IAAI,MAAM,YAAY,OAAO,EAAE;AAChD,gBAAgB,MAAM;AACtB,qBAAqB,IAAI,CAAC,MAAM;AAChC,oBAAoB,IAAI,CAAC,CAAC,EAAE,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC;AAChD,iBAAiB,CAAC;AAClB,qBAAqB,KAAK,CAAC,UAAU,CAAC,CAAC;AACvC,aAAa;AACb,SAAS;AACT,QAAQ,OAAO,GAAG,EAAE;AACpB,YAAY,UAAU,CAAC,GAAG,CAAC,CAAC;AAC5B,SAAS;AACT,KAAK;AACL,IAAI,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,eAAe,CAAC,CAAC;AACzC,IAAI,OAAO,CAAC,EAAE,CAAC,MAAM,EAAE,eAAe,CAAC,CAAC;AACxC;;;;;"}